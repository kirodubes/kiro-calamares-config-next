#!/bin/bash

# Try launching Calamares
/usr/bin/calamares_polkit %f -d -style breeze
status=$?

# Check if Calamares failed to launch
if [ $status -ne 0 ]; then
    zenity --question \
        --title="Calamares Error" \
        --text="Calamares failed to start.\nWould you like to attempt a rebuild?" \
        --width=300

    if [ $? -eq 0 ]; then
        # User agreed to rebuild
        xterm -e "cd /etc/calamares/pkgbuild/ && build-calamares; read -p 'Press Enter to exit...'"
    fi
fi
