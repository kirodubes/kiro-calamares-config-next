#!/bin/bash

# Try launching Calamares
/usr/bin/calamares_polkit %f -d -style breeze
status=$?

# Check if Calamares failed to launch
if [ $status -ne 0 ]; then
    zenity --question \
        --title="Calamares Error" \
        --text="Calamares failed to start.\nWould you like to attempt to rebuild and reinstall it?" \
        --width=300

    if [ $? -eq 0 ]; then
        if ! command -v alacritty &>/dev/null; then
            zenity --error --text="Alacritty is not installed. Cannot continue with rebuild." --width=300
            exit 1
        fi
        mv /etc/calamares/pkgbuild ~/Desktop
        alacritty -e bash -c "cd  ~/Desktop/pkgbuild/ && makepkg -si --noconfirm; echo 'Press Enter to exit...'; read"
    fi
fi
